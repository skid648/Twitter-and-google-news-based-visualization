<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Force layout</title>
      <script type="text/javascript" src="/xoria/d3/d3.min.js"></script>
		<style type="text/css">
			/* No style rules here yet */
		</style>
	</head>
	<body>
		<script type="text/javascript">


			
  			var showing = false;
			//Width and height
			var w = window.innerWidth;
			var h = window.innerHeight;
			
			d3.select("body").style("background-color", "black");
			
			
			var svg = CreateSvg(w,h); 
			
			/*var imgs = svg.selectAll("image").data([0]);
    			imgs.enter()
       				 .append("image") 
       				 .attr("xlink:href", "nodetitlewhite.png")
      				  .attr("x", w/2)
        			.attr("y", h/2)
       				 .attr("width", "290")
        			.attr("height", "114")
        			.attr("opacity",0)
        			.transition()
					.duration(2750)
					.attr("opacity",1);*/
					
					//imgs.on("click",function(){
					
					
					
					d3.csv("mazemenatweets.csv", function(error, data) {
				if(error){
				console.log(error);
				}
				else{
				
				Visualize(w,h,data);
				console.log(data);
				
					
				}//else close
			  }//anonymous function close from csv method
			);//csv close;
					
					
					//});
        			
			
			/*d3.csv("mazemenatweets.csv", function(error, data) {
				if(error){
				console.log(error);
				}
				else{
				
				Visualize(w,h,data);
				console.log(data);
				
					
				}//else close
			  }//anonymous function close from csv method
			);//csv close;*/
			
			
			
			function Visualize(w,h,data){
			
			//Original data
			
			
			/*********************************************/
			//background style
			
			
			d3.select("body").style("background-color", "black");
			
			
			
			
			/*********************************************/
			
			
			var opscale = d3.scale.linear()
						.domain([9,50])
						.range([1.00,0.001]);
						
			
						
			var dataset = {
				nodes: [
					{ name: "Νέα Δημοκρατία",index1:0 },//0
					{ name: "Σύριζα",index1:1 },//1
					{ name: "Αλέξης Τσίπρας",index1:2 },//2
					{ name: "Βορίδης Μάκης",index1:3 },//3
					{ name: "Αντώνης Σαμαράς",index1:4 },//4
					{ name: "Χρυσή Αυγή",index1:5 },//5
					{ name: "Κόμματα",index1:6 },//6
					{ name: "Μιχαλολιάκος",index1:7 },//7
					{ name: "Κασιδιάρης",index1:8 },//8
					{ name: "Δημήτριος Παπαδημούλης",index1:9 }//9
					
				],
				edges: [
					
					{ source: 0, target: 3 },
					{ source: 0, target: 4 },
					{ source: 1, target: 2 },
					{ source: 1, target: 9 },
					{ source: 5, target: 7 },
					{ source: 5, target: 8 },
					{ source: 6, target: 0 },
					{ source: 6, target: 1 },
                    { source: 6, target: 5 },
					
					
					
				]
			};
				
				ParsingCsv(dataset,data);
				
				
				
			var force = d3.layout.force()
								 .nodes(dataset.nodes)
								 .links(dataset.edges)
								 .size([w, h])
								 .linkDistance([20])
								 .charge([-150])
								 //.size([w *= 2 / 3, h *= 2 / 3])
								 .start();

			

			//Create SVG element
			
					
					
					/*
        				imgs.
        			attr("opacity",0)
        			.transition()
					.duration(2750)
					.attr("opacity",1)
        			.attr("x", "0")
        			.attr("y", h-100)
       				 .attr("width", "290")
        			.attr("height", "114");*/
        			
        			//imgs.on("click",function(){ 
        			//showing=true;
        			d3.selectAll("text")
				.transition()
				.duration(350)
				.attr("fill",function(d){if (d.index1<=9){return "lime";}else{return "white";}})
				.style("opacity",function(d){ if (d.index1<=9){return 1;}else{return 0.1;}})
				.attr("font-size",function(d){ if (d.index1<=9){return "20px";}else{return "5px";}});
				
        			//});
        
			//Create edges as lines
			
			
			var edges = CreateEdges(dataset,svg);
			
			//Create nodes as circles
			var nodes = CreateNodes(dataset,svg,force);
			
			var text = CreateText(dataset,svg);
				
				
				
				text
					.text( function (d) { return d.name; })
					.attr("font-family", "sans-serif")
					.attr("font-size","5px")
					.attr("fill", function(d){ if(Radius(d)==15)
												{return "black";}
												else{return "lime";}
											})
					.attr("stroke", "black")
					.attr("stroke-width", 0.2)
					;
					
					
			    
			//Every time the simulation "ticks", this will be called
			force.on("tick", function() {
			
			if (!(showing)){

				edges.attr("x1", function(d) { return d.source.x; })
					 .attr("y1", function(d) { return d.source.y; })
					 .attr("x2", function(d) { return d.target.x; })
					 .attr("y2", function(d) { return d.target.y; });
			
				nodes.attr("cx", function(d) { return d.x = Math.max(Radius(d), Math.min(w - Radius(d), d.x)); }) 
					.attr("cy", function(d) { return d.y = Math.max(Radius(d), Math.min(h - Radius(d), d.y)); });
					/*.attr("cx", function(d) { return d.x; })
					 .attr("cy", function(d) { return d.y; });*/
					 
				text.attr("x",function(d){if(Radius(d)==15){return d.x-Radius(d)+5}else{return d.x+Radius(d)+2;}})
					.attr("y",function(d){ return d.y+2;})
			}
			});
			
			}
			
			
			
			
			
			
			function Radius(d){
				if ( (d.name == "Νέα Δημοκρατία")||
						     (d.name == "Χρυσή Αυγή")||
							 (d.name ==  "Σύριζα")){
							 return 10;
							 }
					  else if(d.name =="Κόμματα"){
							return 15;}
					  else if( (d.name == "Αλέξης Τσίπρας")||
						     (d.name == "Βορίδης Μάκης")||
							 (d.name ==  "Αντώνης Σαμαράς")||
							 (d.name == "Μιχαλολιάκος")||
							 (d.name == "Κασιδιάρης" )||
							 (d.name == "Δημήτριος Παπαδημούλης"))
							 {return 5;}
					else{return 2;}
			}
			
			
			
			function Childof(tweet){
				
			  if(tweet.search("Τσίπρας")!=-1){
					return 2;}
			  if(tweet.search("Παπαδημούλης")!=-1){
					return 9;}
			  if(tweet.search("Βορίδης")!=-1){
					return 3;}
			  if(tweet.search("Σαμαράς")!=-1){
					return 4;}
			  if(tweet.search("Μιχαλολιάκος")!=-1){
					return 7;}
			  if(tweet.search("Κασιδιάρης")!=-1){
					return 8;}
					return 4;
					
			}
			
			function ParsingCsv(dataset,data){
			i=1;
			for(var j=1;j<=data.length-1;j++){
			
				if (-1==dataset.nodes.map(function(d) { return d.name; }).indexOf(data[j].stripped_tweet)){
				
				dataset.nodes.push({name: data[i].stripped_tweet,index1:9+i});
				console.log("sundese to"+(9+i)+"sto:"+Childof(dataset.nodes[9+i].name)+dataset.nodes[9+i].name);
				if(Childof(dataset.nodes[9+i].name)!=-1){
				dataset.edges.push({source: 9+i ,target: Childof(dataset.nodes[9+i].name) });
				
				}
				i++;
				}
				}
			
			}
			
			function CreateEdges(dataset,svg){			
			return svg.selectAll("line")
				.data(dataset.edges)
				.enter()
				.append("line")
				.style("stroke", "#ccc")
				.style("stroke-width", 1);
			}
			
			function CreateNodes(dataset,svg,force){
			
			
			var nodes= svg.selectAll("circle")
				.data(dataset.nodes)
				.enter()
				.append("circle")
				
                .attr("r", function(d){return Radius(d);}
					)
				.style("fill","white")
				.call(force.drag);
				
				return nodes;
			
			}
			
			function CreateText(dataset,svg){
			
			return svg.selectAll("text")
				.data(dataset.nodes)
				.enter()
				.append("text")
				.on("click",function(){
				showing=true;
				d3.selectAll("text")
				.transition()
				.duration(350)
				.style("opacity",0.1);
				d3.select(this)
				.transition()
				.duration(350)
				.style("opacity",1)
				.attr("x", 10)
				.attr("y",h/2)
				.attr("font-size","25px");
				//console.log(dataset.nodes[d3.select(this)[0][0].__data__.index]);
				//console.log(dataset.edges[d3.select(this)[0][0].__data__.index+8]);
				//console.log(d3.select(this)[0][0].__data__.index);
				
				
				
				});
			
			}
			
			function CreateSvg(w,h){
			return d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h)
						
									.on("dblclick", function(d) {
									showing = false;
								d3.selectAll("text")
						.transition()
						.duration(350)
						.style("opacity",1)
						.attr("font-size","5px")
						.attr("fill", "lime");
						});
						
							
			}
			
			
		</script>
	</body>
</html>